<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniChance - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box; 
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: #faf8f3;
            color: #1e3a5f;
            border: 2px solid #1e3a5f;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: #1e3a5f;
            color: #faf8f3;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(30, 58, 95, 0.3);
        }

        @media (max-width: 600px) {
            .nav-buttons {
                gap: 5px;
            }

            .nav-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f1e8;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: #1e3a5f;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: none;
        }

        .header p {
            font-size: 1.1rem;
            color: #5a6c7d;
        }

        .tabs {
            display: flex;
            background: #ffffff;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 10px;
            color: #5a6c7d;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            background: #1e3a5f;
            color: #ffffff;
            box-shadow: 0 2px 8px rgba(30, 58, 95, 0.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .columns-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .column {
            background: #ffffff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        .column-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e3a5f;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid #1e3a5f;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95rem;
        }

        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: inherit;
            background: #ffffff;
        }

        .form-group input:focus, 
        .form-group select:focus {
            outline: none;
            border-color: #1e3a5f;
            box-shadow: 0 0 0 4px rgba(30, 58, 95, 0.08), 0 2px 8px rgba(30, 58, 95, 0.12);
            background: #fafbfc;
        }

        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            background: #ffffff;
            min-height: 100px;
            resize: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #1e3a5f;
            box-shadow: 0 0 0 4px rgba(30, 58, 95, 0.08), 0 4px 12px rgba(30, 58, 95, 0.15);
            background: #fafbfc;
        }

        .form-group textarea::-webkit-scrollbar {
            width: 6px;
        }

        .form-group textarea::-webkit-scrollbar-track {
            background: #f5f7fa;
            border-radius: 10px;
        }

        .form-group textarea::-webkit-scrollbar-thumb {
            background: #c1c8cd;
            border-radius: 10px;
        }

        .form-group textarea::-webkit-scrollbar-thumb:hover {
            background: #1e3a5f;
        }

        .form-group textarea {
            scrollbar-width: thin;
            scrollbar-color: #c1c8cd #f5f7fa;
        }

        .form-group small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85rem;
        }

        .subsection {
            background: #faf8f5;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #1e3a5f;
        }

        .subsection-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .button-container {
            text-align: center;
            margin-top: 30px;
        }

        .btn {
            background: #1e3a5f;
            color: #ffffff;
            padding: 18px 60px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 58, 95, 0.2);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(30, 58, 95, 0.3);
            background: #2d4a6f;
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .result-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }

        .disclaimer {
            text-align: center;
            color: #5a6c7d;
            font-size: 0.9rem;
            margin-top: 20px;
            padding: 15px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .card {
            background: #ffffff;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .community-post {
            background: #faf8f5;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #1e3a5f;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .post-author {
            font-weight: 600;
            color: #1e3a5f;
        }

        .post-date {
            color: #5a6c7d;
            font-size: 0.9rem;
        }

        .university-tag {
            background: #1e3a5f;
            color: #ffffff;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 5px;
        }

        @media (max-width: 1200px) {
            .columns-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .columns-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .btn {
                padding: 15px 40px;
                font-size: 16px;
            }
        }
    </style>
    </head>
 <body>
    <div class="container">
        <div class="header">
            <div class="nav-buttons">
                <a href="community.html" class="nav-btn">üí• –°–æ–æ–±—â–µ—Å—Ç–≤–æ</a>
                <a href="universities.html" class="nav-btn">üè´ –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã</a>
                <a href="register.html" class="nav-btn">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
            <h1>üéì UniChance</h1>
            <p>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–∏ —à–∞–Ω—Å—ã –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –º–∏—Ä–∞</p>
        </div>
     
        <div class="tabs">
            <div class="tab active" onclick="switchTab('calculator')">
                üìä –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —à–∞–Ω—Å–æ–≤
            </div>
            <div class="tab" onclick="switchTab('community')">
                üí• –°–æ–æ–±—â–µ—Å—Ç–≤–æ
            </div>
        </div>

        <div id="calculator" class="tab-content active">
            <form id="chancesForm" onsubmit="event.preventDefault(); calculateChances();">
                <div class="columns-container">
                    <div class="column">
                        <div class="column-title">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                        <div class="form-group">
                            <label>–§–ò–û *</label>
                            <input type="text" id="userName" required>
                        </div>
                        <div class="form-group">
                            <label>–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç *</label>
                            <select id="university" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å *</label>
                            <select id="major" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ü–æ—Å—Ç—É–ø–∞–µ—Ç–µ –Ω–∞ –≥—Ä–∞–Ω—Ç? *</label>
                            <select id="scholarship" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ</option>
                                <option value="yes">–î–∞</option>
                                <option value="no">–ù–µ—Ç</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–£—Ä–æ–≤–µ–Ω—å –æ–±—É—á–µ–Ω–∏—è *</label>
                            <select id="degree_level" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å</option>
                                <option value="bachelor">–ë–∞–∫–∞–ª–∞–≤—Ä–∏–∞—Ç</option>
                                <option value="master">–ú–∞–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞</option>
                                <option value="phd">–î–æ–∫—Ç–æ—Ä–∞–Ω—Ç—É—Ä–∞</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥ —Å–µ–º—å–∏ (USD)</label>
                            <input type="number" id="family_income" min="0" placeholder="50000">
                        </div>
                        <div class="form-group">
                            <label>GPA (0-4.0) *</label>
                            <input type="number" id="gpa" min="0" max="4" step="0.1" placeholder="3.8" required>
                        </div>
                        <div class="form-group">
                            <label>SAT (400-1600)</label>
                            <input type="number" id="sat" min="400" max="1600" placeholder="1200">
                        </div>
                        <div class="form-group">
                            <label>IELTS (0-9)</label>
                            <input type="number" id="ielts" min="0" max="9" step="0.5" placeholder="7.0">
                        </div>
                        <div class="form-group">
                            <label>TOEFL (0-120)</label>
                            <input type="number" id="toefl" min="0" max="120" placeholder="100">
                        </div>
                        <div class="form-group">
                            <label>–ï–ù–¢ (0-140)</label>
                            <input type="number" id="ent" min="0" max="140" placeholder="130">
                        </div>
                    </div>

                    <div class="column">
                        <div class="column-title">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è / Honours</div>
                        <div class="subsection">
                            <div class="subsection-title">üèÖ –û–ª–∏–º–ø–∏–∞–¥—ã –∏ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è</div>
                            <textarea id="olympics" placeholder="–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ - 2 –º–µ—Å—Ç–æ, –†–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Å–∫–∞—è –æ–ª–∏–º–ø–∏–∞–¥–∞ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ - 1 –º–µ—Å—Ç–æ..."></textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">üî¨ –ù–∞—É—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</div>
                            <textarea id="research" placeholder="–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –≤ –æ–±–ª–∞—Å—Ç–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ –∂—É—Ä–Ω–∞–ª–µ, —Ä–∞–±–æ—Ç–∞ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏..."></textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">üìä IT –ø—Ä–æ–µ–∫—Ç—ã –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞</div>
                            <textarea id="projects" placeholder="–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (50k+ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π), open source –ø—Ä–æ–µ–∫—Ç—ã –Ω–∞ GitHub..."></textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">üöÄ –°—Ç–∞—Ä—Ç–∞–ø—ã –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–æ</div>
                            <textarea id="startup" placeholder="–û—Å–Ω–æ–≤–∞–ª EdTech —Å—Ç–∞—Ä—Ç–∞–ø, –≥—Ä–∞–Ω—Ç –æ—Ç Astana Hub, –≤—ã—Ä—É—á–∫–∞ $10k..."></textarea>
                        </div>
                    </div>

                    <div class="column">
                        <div class="column-title">üéØ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ / Activities</div>
                        <div class="subsection">
                            <div class="subsection-title">üé§ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ –∏ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è</div>
                            <textarea id="conferences" placeholder="–î–æ–∫–ª–∞–¥—á–∏–∫ –Ω–∞ TEDx Talk, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏–µ –Ω–∞ Kazakhstan AI Conference..."></textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">‚ù§Ô∏è –í–æ–ª–æ–Ω—Ç—ë—Ä—Å–∫–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                            <textarea id="volunteer" placeholder="–í–æ–ª–æ–Ω—Ç—ë—Ä –≤ –¥–µ—Ç—Å–∫–æ–º –¥–æ–º–µ (200+ —á–∞—Å–æ–≤), –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ—Ç—è–º..."></textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">üëë –õ–∏–¥–µ—Ä—Å—Ç–≤–æ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</div>
                            <textarea id="leadership" placeholder="–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç —à–∫–æ–ª—å–Ω–æ–≥–æ —Å–æ–≤–µ—Ç–∞, –∫–∞–ø–∏—Ç–∞–Ω –∫–æ–º–∞–Ω–¥—ã –ø–æ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–µ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Ö–∞–∫–∞—Ç–æ–Ω–∞..."></textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ</div>
                            <textarea id="arts" placeholder="–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∫–æ–Ω–∫—É—Ä—Å–∞ —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤, –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –∞–ª—å–±–æ–º –Ω–∞ Spotify..."></textarea>
                        </div>
                        <div class="subsection">
                            <div class="subsection-title">üíº –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∏ –∏ —Ä–∞–±–æ—á–∏–π –æ–ø—ã—Ç</div>
                            <textarea id="work_experience" placeholder="–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞ –≤ Google (3 –º–µ—Å—è—Ü–∞), —Ä–∞–±–æ—Ç–∞ –≤ —Å—Ç–∞—Ä—Ç–∞–ø–µ –∫–∞–∫ junior developer..."></textarea>
                        </div>
                    </div>

                    <div class="column">
                        <div class="column-title">üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã</div>
                        <div class="form-group">
                            <label>–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —ç—Å—Å–µ</label>
                            <textarea id="sopTextArea" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —ç—Å—Å–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –Ω–∏–∂–µ..."></textarea>
                            <input type="file" id="sop" accept=".docx">
                            <small>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ DOCX</small>
                        </div>
                        <div class="form-group">
                            <label>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ</label>
                            <textarea id="lorTextArea" rows="5" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –Ω–∏–∂–µ..."></textarea>
                            <input type="file" id="lor" accept=".docx">
                            <small>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ DOCX</small>
                        </div>
                        <div style="margin-top: 30px; padding: 20px; background: #e8f0f7; border-radius: 12px; border-left: 4px solid #1e3a5f;">
                            <p style="font-size: 0.9rem; color: #333; line-height: 1.6;">
                                <strong>üí° –°–æ–≤–µ—Ç:</strong> –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞, –Ω–æ –º–æ–∂–µ—Ç –ø–æ–≤—ã—Å–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–∞ –≤–∞—à–∏—Ö —à–∞–Ω—Å–æ–≤ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="button-container">
                    <button class="btn" type="submit">üéØ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</button>
                </div>
            </form>

            <div id="result"></div>
            
            <div class="disclaimer">
                ‚ö†Ô∏è –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–∞–Ω–Ω—ã–µ —à–∞–Ω—Å—ã —è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –≤–∫–ª—é—á–∞—è –∫–æ–Ω–∫—É—Ä—Å, –ø–æ–ª–∏—Ç–∏–∫—É —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –∏ –¥—Ä—É–≥–∏–µ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞.
            </div>
        </div>

        <div id="community" class="tab-content">
            <div class="card">
                <h2>üéì –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</label>
                        <input type="text" id="postUniversity" placeholder="Harvard University">
                    </div>
                    <div class="form-group">
                        <label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</label>
                        <input type="text" id="postMajor" placeholder="Computer Science">
                    </div>
                </div>
                <div class="form-group">
                    <label>–í–∞—à–∏ –±–∞–ª–ª—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</label>
                    <textarea id="postScores" rows="3" placeholder="SAT: 1450, IELTS: 7.5, —É—á–∞—Å—Ç–∏–µ –≤ –æ–ª–∏–º–ø–∏–∞–¥–∞—Ö –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é, –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ..."></textarea>
                </div>
                <div class="form-group">
                    <label>–°–æ–≤–µ—Ç—ã –¥–ª—è –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö</label>
                    <textarea id="postAdvice" rows="4" placeholder="–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏ –∏ –æ–ø—ã—Ç–æ–º..."></textarea>
                </div>
                <h3 style="margin: 25px 0 15px 0;">üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —ç—Å—Å–µ (DOCX)</label>
                        <input type="file" id="postSop" accept=".docx">
                    </div>
                    <div class="form-group">
                        <label>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ (DOCX)</label>
                        <input type="file" id="postLor" accept=".docx">
                    </div>
                </div>
                <button class="btn" onclick="addPost()" style="margin-top: 20px;">üìù –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç</button>
            </div>

            <div class="card">
                <h2>üí¨ –û–ø—ã—Ç –ø–æ—Å—Ç—É–ø–∏–≤—à–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>
                <div id="communityPosts"></div>
            </div>
        </div>
    </div>
    <script>
        const SUPABASE_URL = 'https://jdxzxpvcjttvrpnnkzkq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkeHp4cHZjanR0dnJwbm5remtxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYwNjM2ODksImV4cCI6MjA3MTYzOTY4OX0.reUTSATfG0GM6eg8_485oLmHNM82U9XuHFzQ53MZvbA';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        const samplePosts = [
            {
                author: "–ê–ª–∏—è –ö.",
                university: "MIT",
                major: "Computer Science",
                date: "2024-08-15",
                scores: "SAT: 1520, IELTS: 8.0, –ï–ù–¢: 135",
                activities: "–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –æ–ª–∏–º–ø–∏–∞–¥—ã –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é, —Å—Ç–∞—Ä—Ç–∞–ø –≤ –æ–±–ª–∞—Å—Ç–∏ –ò–ò",
                advice: "–ù–∞—á–Ω–∏—Ç–µ –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ SAT –∑–∞ –≥–æ–¥, —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –æ–ª–∏–º–ø–∏–∞–¥–∞—Ö –∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ —Å–≤–æ–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤."
            },
            {
                author: "–ï—Ä–Ω—É—Ä –ê.",
                university: "Stanford University",
                major: "Engineering",
                date: "2024-07-28",
                scores: "SAT: 1480, TOEFL: 115, –ï–ù–¢: 138",
                activities: "–ù–∞—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –ø–æ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–µ, –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ, –∫–∞–ø–∏—Ç–∞–Ω —à–∫–æ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã",
                advice: "–ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –Ω–µ —Ç–æ–ª—å–∫–æ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –Ω–æ –∏ –ª–∏–¥–µ—Ä—Å–∫–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞. –≠—Å—Å–µ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ - —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é."
            },
            {
                author: "–ú–∞–¥–∏–Ω–∞ –°.",
                university: "Harvard University",
                major: "Economics",
                date: "2024-08-10",
                scores: "SAT: 1450, IELTS: 7.5, GPA: 3.9",
                activities: "–ú–æ–¥–µ–ª—å –û–û–ù, —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π –∫–ª—É–±, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ –º–∏–∫—Ä–æ—Ñ–∏–Ω–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—é",
                advice: "–ù–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –±–∞–ª–ª–∞—Ö. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –∏—â—É—Ç —Ä–∞–∑–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ª–∏—á–Ω–æ—Å—Ç–µ–π —Å —á–µ—Ç–∫–æ–π –º–æ—Ç–∏–≤–∞—Ü–∏–µ–π."
            }
        ];

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                university: params.get('university'),
                major: params.get('major')
            };
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –∏–∑ URL
        function autoFillFromUrl() {
            const { university, major } = getUrlParams();
            
            if (university) {
                const universitySelect = document.getElementById('university');
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤
                setTimeout(() => {
                    for (let i = 0; i < universitySelect.options.length; i++) {
                        if (universitySelect.options[i].value === university) {
                            universitySelect.value = university;
                            // –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ change –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π
                            universitySelect.dispatchEvent(new Event('change'));
                            break;
                        }
                    }
                }, 500);
            }
            
            if (major) {
                // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π (–±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —Ç.–∫. –æ–Ω–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞)
                setTimeout(() => {
                    const majorSelect = document.getElementById('major');
                    for (let i = 0; i < majorSelect.options.length; i++) {
                        if (majorSelect.options[i].value === major) {
                            majorSelect.value = major;
                            break;
                        }
                    }
                }, 1500);
            }
        }

        document.getElementById('university').addEventListener('change', async function() {
            const university = this.value;
            const majorSelect = document.getElementById('major');
            majorSelect.innerHTML = '<option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</option>';
            if (!university) return;
            try {
                const { data, error } = await supabase.from('university_requirements').select('major').eq('university', university);
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π:', error);
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞');
                    return;
                }
                const majors = [...new Set(data.map(item => item.major))];
                majorSelect.innerHTML = '<option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</option>' + majors.map(m => `<option value="${m}">${m}</option>`).join('');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π');
            }
        });

        // –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è window.onload —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º autoFillFromUrl
        window.onload = function() {
            loadProfileData();
            loadCommunityPosts();
            populateDropdowns();
            autoFillFromUrl(); // –î–û–ë–ê–í–õ–ï–ù–ê –≠–¢–ê –°–¢–†–û–ö–ê
        };

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        async function fetchUniversityRequirements(university, major) {
            try {
                const { data, error } = await supabase.from('university_requirements').select('sat_typical, ielts_typical, toefl_typical, ent_typical, gpa_typical, additional_requirements').eq('university', university).eq('major', major).single();
                if (error) throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: ${error.message}`);
                if (!data) throw new Error(`–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è ${university} - ${major} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`);
                return data;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç.');
                return null;
            }
        }
        
        async function fetchCollegeData(university) {
            const API_KEY = '6OczPauz3axM3EeUlnfCZyaBj8zWApvuqOYvc3CT';
            const encodedUniversity = encodeURIComponent(university);
            const url = `https://api.data.gov/ed/collegescorecard/v1/schools?api_key=${API_KEY}&school.name=${encodedUniversity}&fields=school.name,latest.admissions.admission_rate.overall,latest.admissions.sat_scores.average.overall,latest.cost.avg_net_price.overall,latest.student.size,latest.student.retention_rate.overall.full_time,latest.admissions.test_requirements`;
            const response = await fetch(url);
            if (!response.ok) throw new Error(`College Scorecard API error: ${response.status}`);
            const data = await response.json();
            return data.results?.[0] || null;
        }

        async function calculateChances() {
            const university = document.getElementById('university').value;
            const major = document.getElementById('major').value;
            const sat = parseInt(document.getElementById('sat').value) || 0;
            const ielts = parseFloat(document.getElementById('ielts').value) || 0;
            const toefl = parseInt(document.getElementById('toefl').value) || 0;
            const ent = parseInt(document.getElementById('ent').value) || 0;
            const gpa = parseFloat(document.getElementById('gpa').value) || 0;
            const family_income = parseInt(document.getElementById('family_income').value) || 0;
            const work_experience = document.getElementById('work_experience').value.trim();

            const activities = {
                olympics: document.getElementById('olympics').value.trim(),
                research: document.getElementById('research').value.trim(),
                projects: document.getElementById('projects').value.trim(),
                startup: document.getElementById('startup').value.trim(),
                conferences: document.getElementById('conferences').value.trim(),
                volunteer: document.getElementById('volunteer').value.trim(),
                leadership: document.getElementById('leadership').value.trim(),
                arts: document.getElementById('arts').value.trim(),
                work_experience: work_experience
            };

            const sopFile = document.getElementById('sop').files[0];
            const lorFile = document.getElementById('lor').files[0];
            const [sop_text, lor_text] = await Promise.all([
                sopFile ? extractTextFromDocx(sopFile).catch(() => { alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è SOP.'); return ''; }) : Promise.resolve(document.getElementById('sopTextArea').value || ''),
                lorFile ? extractTextFromDocx(lorFile).catch(() => { alert('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è LOR.'); return ''; }) : Promise.resolve(document.getElementById('lorTextArea').value || '')
            ]);

            if (!university || !major) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å');
                return;
            }

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="result-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h2>ü§ñ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å...</h2>
                    <p>–ò–ò –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
                    <div style="margin: 20px 0;">
                        <div style="width: 100%; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden;">
                            <div style="width: 0%; height: 100%; background: white; border-radius: 2px; animation: loading 3s ease-in-out infinite;"></div>
                        </div>
                    </div>
                </div>
                <style>
                @keyframes loading { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }
                </style>
            `;

            try {
                const [requirements, collegeData] = await Promise.all([fetchUniversityRequirements(university, major), fetchCollegeData(university)]);
                const combinedData = { university, major, sat, ielts, toefl, ent, gpa, family_income, work_experience, activities, sop_text, lor_text, requirements, collegeData };
                const openAIResponse = await callOpenAIAPI(combinedData);
                displayDetailedResult(openAIResponse, university, major, combinedData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç.');
                fallbackCalculation(university, major, { sat, ielts, toefl, ent, gpa, family_income, work_experience, activities, requirements });
            }
        }
        
        async function extractTextFromDocx(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        const arrayBuffer = e.target.result;
                        const result = await mammoth.extractRawText({arrayBuffer: arrayBuffer});
                        resolve(result.value.trim());
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        async function callOpenAIAPI(data) {
            const collegeInfo = data.collegeData ? `
–†–ï–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –ò–ó COLLEGE SCORECARD –î–õ–Ø ${data.university.toUpperCase()}:
- –£—Ä–æ–≤–µ–Ω—å –ø—Ä–∏—ë–º–∞: ${data.collegeData['latest.admissions.admission_rate.overall'] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
- –°—Ä–µ–¥–Ω–∏–π SAT: ${data.collegeData['latest.admissions.sat_scores.average.overall'] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
- –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${data.collegeData['latest.cost.avg_net_price.overall'] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
- –†–∞–∑–º–µ—Ä —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞: ${data.collegeData['latest.student.size'] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- Retention rate: ${data.collegeData['latest.student.retention_rate.overall.full_time'] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–µ—Å—Ç–∞–º: ${data.collegeData['latest.admissions.test_requirements'] || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
    ` : '–î–∞–Ω–Ω—ã–µ –∏–∑ College Scorecard –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã.';
            const requirementsInfo = data.requirements ? `
–¢–†–ï–ë–û–í–ê–ù–ò–Ø –£–ù–ò–í–ï–†–°–ò–¢–ï–¢–ê –ò–ó SUPABASE –î–õ–Ø ${data.university.toUpperCase()} (${data.major}):
- –¢–∏–ø–∏—á–Ω—ã–π SAT: ${data.requirements.sat_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –¢–∏–ø–∏—á–Ω—ã–π IELTS: ${data.requirements.ielts_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –¢–∏–ø–∏—á–Ω—ã–π TOEFL: ${data.requirements.toefl_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –¢–∏–ø–∏—á–Ω—ã–π –ï–ù–¢: ${data.requirements.ent_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –¢–∏–ø–∏—á–Ω—ã–π GPA: ${data.requirements.gpa_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è: ${data.requirements.additional_requirements || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}
    ` : '–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ Supabase –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã.';
            const prompt = `
–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è–º –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –º–∏—Ä–∞. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞, —Å—Ä–∞–≤–Ω–∏–≤–∞—è —Å —Ç–∏–ø–∏—á–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∏–∑ Supabase –∏ –¥–∞–Ω–Ω—ã–º–∏ College Scorecard (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã). –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∫—Ä–∞–π–Ω—ã–µ —Å–ª—É—á–∞–∏ (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–Ω–∏–∂–∞–µ—Ç —à–∞–Ω—Å—ã). –î–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã –Ω–∞ 2025 –≥–æ–¥.–¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã  –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ.

${collegeInfo}
${requirementsInfo}

–î–ê–ù–ù–´–ï –°–¢–£–î–ï–ù–¢–ê:
- –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç: ${data.university}
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: ${data.major}
- SAT: ${data.sat || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
- IELTS: ${data.ielts || '–Ω–µ —É–∫–∞–∑–∞–Ω'}  
- TOEFL: ${data.toefl || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
- –ï–ù–¢: ${data.ent || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
- GPA: ${data.gpa || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
- –ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥ —Å–µ–º—å–∏: ${data.family_income || '–Ω–µ —É–∫–∞–∑–∞–Ω'} USD
- –†–∞–±–æ—á–∏–π –æ–ø—ã—Ç: ${data.work_experience || '–Ω–µ —É–∫–∞–∑–∞–Ω'}

–ê–ö–¢–ò–í–ù–û–°–¢–ò:
- –û–ª–∏–º–ø–∏–∞–¥—ã: ${data.activities.olympics || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}
- –ù–∞—É—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã: ${data.activities.research || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}
- IT –ø—Ä–æ–µ–∫—Ç—ã: ${data.activities.projects || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}
- –°—Ç–∞—Ä—Ç–∞–ø—ã: ${data.activities.startup || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}
- –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏: ${data.activities.conferences || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}
- –í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ: ${data.activities.volunteer || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –õ–∏–¥–µ—Ä—Å—Ç–≤–æ: ${data.activities.leadership || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ: ${data.activities.arts || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
- –†–∞–±–æ—á–∏–π –æ–ø—ã—Ç: ${data.activities.work_experience || '–Ω–µ —É–∫–∞–∑–∞–Ω—ã'}

–î–û–ö–£–ú–ï–ù–¢–´:
- –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —ç—Å—Å–µ: ${data.sop_text || '–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ'}
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ: ${data.lor_text || '–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ'}

–ò–ù–°–¢–†–£–ö–¶–ò–ò:
- –°—Ä–∞–≤–Ω–∏ SAT, IELTS, TOEFL, –ï–ù–¢, GPA —Å —Ç–∏–ø–∏—á–Ω—ã–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∏–∑ Supabase. –ï—Å–ª–∏ –±–∞–ª–ª—ã –Ω–∏–∂–µ —Ç–∏–ø–∏—á–Ω—ã—Ö, —Å–Ω–∏–∂–∞–π —à–∞–Ω—Å –Ω–∞ 10-20% –∑–∞ –∫–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä.
- –£—á–∏—Ç—ã–≤–∞–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä., CS ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞–º –∏ –æ–ª–∏–º–ø–∏–∞–¥–∞–º).
–†–∞—Å—Å—á–∏—Ç–∞–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤—É–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤—É–∑–∞, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É–ª—É:
$ P(\\text{admit}) = \\frac{1}{1 + e^{-Z}} \\times (1 - R) \\times D $
–ì–¥–µ:

Z = 0.4 √ó A + 0.3 √ó E + 0.15 √ó P + 0.15 √ó F - log(R)
A (–∞–∫–∞–¥–µ–º–∏–∫–∞, 0-1): (GPA / —Å—Ä–µ–¥–Ω–∏–π GPA –≤—É–∑–∞) + (—Ç–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–ª / —Å—Ä–µ–¥–Ω–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–ª –≤—É–∑–∞) + (–∫–æ–ª-–≤–æ AP/IB –∫—É—Ä—Å–æ–≤ / max –≤–æ–∑–º–æ–∂–Ω–æ–µ). –ï—Å–ª–∏ –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ (-10%), A -= 0.2.
E (–≤–Ω–µ–∫–ª–∞—Å—Å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, 0-1): 0.1 –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–æ–ª–∏–º–ø–∏–∞–¥—ã, —Å–ø–æ—Ä—Ç, –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ, research, –ª–∏–¥–µ—Ä—Å—Ç–≤–æ), max 1. +0.1 –∑–∞ —Å–≤—è–∑—å —Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å—é.
P (–ª–∏—á–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞, 0-1): –û—Ü–µ–Ω–∏—Ç–µ —ç—Å—Å–µ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ (0-100, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ 0-1). +0.1 –∑–∞ —Å–∏–ª—å–Ω–æ–µ —ç—Å—Å–µ, -0.2 –∑–∞ —Å–ª–∞–±–æ–µ.
F (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—É–∑—É, 0-1): 0.2 –∑–∞ demonstrated interest (–≤–∏–∑–∏—Ç—ã, emails), +0.3 –∑–∞ legacy/athletics, +0.2 –∑–∞ underrepresented groups/low-income.
R (admission rate –≤—É–∑–∞, 0-1): –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—É–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.05 –¥–ª—è Harvard).
D (–¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä, 0.8-1.2): 1.1 –¥–ª—è underrepresented minorities/low-income, 0.9 –¥–ª—è overrepresented groups, –∏–Ω–∞—á–µ 1.
e ‚âà 2.718.

–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç: [–Ω–∞–∑–≤–∞–Ω–∏–µ –≤—É–∑–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, "Harvard"]
GPA: [—á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, 3.8], —Å—Ä–µ–¥–Ω–∏–π GPA –≤—É–∑–∞: [—á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, 3.9]
–¢–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–ª: [SAT/ACT/–ï–ì–≠, –Ω–∞–ø—Ä–∏–º–µ—Ä, 1450], —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –≤—É–∑–∞: [–Ω–∞–ø—Ä–∏–º–µ—Ä, 1500]
AP/IB –∫—É—Ä—Å—ã: [—á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, 5], max –≤–æ–∑–º–æ–∂–Ω–æ–µ: [–Ω–∞–ø—Ä–∏–º–µ—Ä, 8]
–í–Ω–µ–∫–ª–∞—Å—Å–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏: [—Å–ø–∏—Å–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä, "–æ–ª–∏–º–ø–∏–∞–¥—ã, –≤–æ–ª–æ–Ω—Ç—ë—Ä—Å—Ç–≤–æ, CS-–ø—Ä–æ–µ–∫—Ç"]
–≠—Å—Å–µ: [–æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ —Ç–µ–∫—Å—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, "—Å–∏–ª—å–Ω–æ–µ —ç—Å—Å–µ –æ –ª–∏–¥–µ—Ä—Å—Ç–≤–µ"]
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: [–æ–ø–∏—Å–∞–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, "2 —Å–∏–ª—å–Ω—ã–µ –æ—Ç —É—á–∏—Ç–µ–ª–µ–π"]
Demonstrated interest: [–¥–∞/–Ω–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø–æ—Å–µ—â–∞–ª –∫–∞–º–ø—É—Å"]
Legacy/athletics: [–¥–∞/–Ω–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä, "–Ω–µ—Ç"]
–î–µ–º–æ–≥—Ä–∞—Ñ–∏—è: [–Ω–∞–ø—Ä–∏–º–µ—Ä, "low-income, underrepresented minority"]

–ó–∞–¥–∞—á–∞:

–†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ A, E, P, F (–Ω–æ—Ä–º–∞–ª–∏–∑—É–π—Ç–µ 0-1).
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ R (admission rate) –∏–∑ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.05 –¥–ª—è —Ç–æ–ø-–≤—É–∑–∞).
–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ D –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏–∏.
–í—ã—á–∏—Å–ª–∏—Ç–µ Z –∏ P(admit).
–í–µ—Ä–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ % (–æ–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 1 –∑–Ω–∞–∫–∞) –∏ –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –∫–∞–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–æ–≤–ª–∏—è–ª–∏.
–£–∫–∞–∂–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏ (¬±15%) –∏–∑-–∑–∞ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.
–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (JSON):
{
    "admission_chance": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 100,
    "strength_analysis": {
        "academic_strengths": ["—Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, —Å—Å—ã–ª–∞—è—Å—å –Ω–∞ Supabase"],
        "extracurricular_strengths": ["—Å–∏–ª—å–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"],
        "unique_factors": ["—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞"],
        "weaknesses": ["—Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã, —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏"]
    },
    "improvement_recommendations": [
        {
            "category": "–∫–∞—Ç–µ–≥–æ—Ä–∏—è",
            "recommendation": "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è (—É—á–∏—Ç—ã–≤–∞–π Supabase, College Scorecard–¥–∞–Ω–Ω—ã–µ)",
            "priority": "high/medium/low",
            "timeline": "—Å—Ä–æ–∫–∏"
        }
    ],
    "comparable_profiles": ["–ø—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π"],
    "alternative_universities": [
        {
            "name": "—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç",
            "chance": —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 100,
            "reason": "–ø–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç (—Å—Å—ã–ª–∫–∞ –Ω–∞ Supabase)"
        }
    ],
    "documents_feedback": {
        "motivation_essay": {
         "motivation_passion": "–±–∞–ª–ª 1-100 –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑.–ù—É–∂–Ω–æ —á—Ç–æ–±—ã —Ç—ã —á–µ—Ç–∫–æ –æ–±–æ—Å–Ω–æ–≤–∞–ª —Å–≤–æ–π –±–∞–ª,–ø–æ—á–µ–º—É —Ç—ã –ø–æ—Å—Ç–∞–≤–∏–ª —Ç–∞–∫—É—é –æ—Ü–µ–Ω–∫—É.–ü–∏—à–∏ –ü–û–î–†–û–ë–ù–û",
         "academic_prep": "–±–∞–ª–ª 1-100 –∏  –ü–û–î–†–û–ë–ù–´–ô –∞–Ω–∞–ª–∏–∑.–ù—É–∂–Ω–æ —á—Ç–æ–±—ã —Ç—ã —á–µ—Ç–∫–æ –æ–±–æ—Å–Ω–æ–≤–∞–ª —Å–≤–æ–π –±–∞–ª,–ø–æ—á–µ–º—É —Ç—ã –ø–æ—Å—Ç–∞–≤–∏–ª —Ç–∞–∫—É—é –æ—Ü–µ–Ω–∫—É.–ü–∏—à–∏ –ü–û–î–†–û–ë–ù–û ",
        "uniqueness": "–±–∞–ª–ª 1-100 –∏ –ü–û–î–†–û–ë–ù–´–ô –∞–Ω–∞–ª–∏–∑.–ù—É–∂–Ω–æ —á—Ç–æ–±—ã —Ç—ã —á–µ—Ç–∫–æ –æ–±–æ—Å–Ω–æ–≤–∞–ª —Å–≤–æ–π –±–∞–ª,–ø–æ—á–µ–º—É —Ç—ã –ø–æ—Å—Ç–∞–≤–∏–ª —Ç–∞–∫—É—é –æ—Ü–µ–Ω–∫—É.–ü–∏—à–∏ –ü–û–î–†–û–ë–ù–û ",
         "goals_vision": "–±–∞–ª–ª 1-100 –∏ –ü–û–î–†–û–ë–ù–´–ô –∞–Ω–∞–ª–∏–∑.–ù—É–∂–Ω–æ —á—Ç–æ–±—ã —Ç—ã —á–µ—Ç–∫–æ –æ–±–æ—Å–Ω–æ–≤–∞–ª —Å–≤–æ–π –±–∞–ª,–ø–æ—á–µ–º—É —Ç—ã –ø–æ—Å—Ç–∞–≤–∏–ª —Ç–∞–∫—É—é –æ—Ü–µ–Ω–∫—É.–ü–∏—à–∏ –ü–û–î–†–û–ë–ù–û ",
         "writing_quality": "–±–∞–ª–ª 1-100 –∏ –ü–û–î–†–û–ë–ù–´–ô –∞–Ω–∞–ª–∏–∑.–ù—É–∂–Ω–æ —á—Ç–æ–±—ã —Ç—ã —á–µ—Ç–∫–æ –æ–±–æ—Å–Ω–æ–≤–∞–ª —Å–≤–æ–π –±–∞–ª,–ø–æ—á–µ–º—É —Ç—ã –ø–æ—Å—Ç–∞–≤–∏–ª —Ç–∞–∫—É—é –æ—Ü–µ–Ω–∫—É.–ü–∏—à–∏ –ü–û–î–†–û–ë–ù–û "
        },
        "recommendation_letter": {
            "academic_achievements": "–±–∞–ª–ª 1-100 –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, –Ω–∞–ø–∏—à–∏ "–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
            "personal_qualities": "–±–∞–ª–ª 1-100 –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, –Ω–∞–ø–∏—à–∏ "–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
            "leadership_teamwork": "–±–∞–ª–ª 1-100 –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, –Ω–∞–ø–∏—à–∏ "–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
            "success_potential": "–±–∞–ª–ª 1-100 –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, –Ω–∞–ø–∏—à–∏ "–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ",
            "comparison_examples": "–±–∞–ª–ª 1-100 –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" –µ—Å–ª–∏ –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, –Ω–∞–ø–∏—à–∏ "–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ"
        }
    },
    "overall_assessment": "–æ–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ (—É–ø–æ–º—è–Ω–∏ Supabase –¥–∞–Ω–Ω—ã–µ)"
}
    `;
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer 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'
                },
                body: JSON.stringify({
                    model: 'ft:gpt-4.1-nano-2025-04-14:unichance::CT2ftYux',
                    messages: [{ role: 'user', content: prompt }],
                    temperature: 0.7,
                    max_tokens: 3000
                })
            });
            if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ HTTP! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            const result = await response.json();
            const content = result.choices[0].message.content;
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            if (jsonMatch) return JSON.parse(jsonMatch[0]);
            throw new Error('–í –æ—Ç–≤–µ—Ç–µ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π JSON');
        }

        function displayDetailedResult(openAIResponse, university, major, data) {
            const resultDiv = document.getElementById('result');
            const chance = openAIResponse.admission_chance;
            let resultClass = chance >= 70 ? 'result-high' : chance >= 40 ? 'result-medium' : 'result-low';
            let chanceText = chance >= 70 ? 'üéâ –í—ã—Å–æ–∫–∏–µ —à–∞–Ω—Å—ã' : chance >= 40 ? '‚ö° –°—Ä–µ–¥–Ω–∏–µ —à–∞–Ω—Å—ã' : 'üìö –¢—Ä–µ–±—É—é—Ç—Å—è —É—Å–∏–ª–∏—è';
            let documentsFeedbackHtml = '';
            if (openAIResponse.documents_feedback) {
                documentsFeedbackHtml = `
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h3>üìÑ –§–∏–¥–±–µ–∫ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º</h3>
                        ${openAIResponse.documents_feedback.motivation_essay ? `
                        <div style="margin-bottom: 20px;">
                            <h4>–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–µ —ç—Å—Å–µ</h4>
                            <ul style="margin-top: 10px; line-height: 1.6;">
                                <li><strong>–ú–æ—Ç–∏–≤–∞—Ü–∏—è –∏ —Å—Ç—Ä–∞—Å—Ç—å:</strong> ${openAIResponse.documents_feedback.motivation_essay.motivation_passion}</li>
                                <li><strong>–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞:</strong> ${openAIResponse.documents_feedback.motivation_essay.academic_prep}</li>
                                <li><strong>–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:</strong> ${openAIResponse.documents_feedback.motivation_essay.uniqueness}</li>
                                <li><strong>–¶–µ–ª–∏ –∏ –≤–∏–¥–µ–Ω–∏–µ:</strong> ${openAIResponse.documents_feedback.motivation_essay.goals_vision}</li>
                                <li><strong>–ö–∞—á–µ—Å—Ç–≤–æ –ø–∏—Å—å–º–∞:</strong> ${openAIResponse.documents_feedback.motivation_essay.writing_quality}</li>
                            </ul>
                        </div>` : ''}
                        ${openAIResponse.documents_feedback.recommendation_letter ? `
                        <div>
                            <h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ</h4>
                            <ul style="margin-top: 10px; line-height: 1.6;">
                                <li><strong>–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</strong> ${openAIResponse.documents_feedback.recommendation_letter.academic_achievements}</li>
                                <li><strong>–õ–∏—á–Ω–æ—Å—Ç–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞:</strong> ${openAIResponse.documents_feedback.recommendation_letter.personal_qualities}</li>
                                <li><strong>–õ–∏–¥–µ—Ä—Å—Ç–≤–æ –∏ –∫–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞:</strong> ${openAIResponse.documents_feedback.recommendation_letter.leadership_teamwork}</li>
                                <li><strong>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª —É—Å–ø–µ—Ö–∞:</strong> ${openAIResponse.documents_feedback.recommendation_letter.success_potential}</li>
                                <li><strong>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä—ã:</strong> ${openAIResponse.documents_feedback.recommendation_letter.comparison_examples}</li>
                            </ul>
                        </div>` : ''}
                    </div>
                `;
            }
            resultDiv.innerHTML = `
                <div class="result-card ${resultClass}">
                    <h2>${chanceText} –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è (${Math.round(chance)}%)</h2>
                    <p style="margin: 10px 0;">–¥–ª—è ${university} - ${major} (–Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö College Scorecard)</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h3>üéØ –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è –æ—Ç –ò–ò</h3>
                        <p style="margin-top: 10px; line-height: 1.6;">${openAIResponse.overall_assessment}</p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px;">
                            <h4>üí™ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</h4>
                            <div style="margin-top: 10px;">
                                <strong>–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ:</strong>
                                <ul style="margin: 5px 0 10px 20px;">
                                    ${openAIResponse.strength_analysis.academic_strengths.map(s => `<li>${s}</li>`).join('')}
                                </ul>
                                <strong>–í–Ω–µ—à–∫–æ–ª—å–Ω—ã–µ:</strong>
                                <ul style="margin: 5px 0 10px 20px;">
                                    ${openAIResponse.strength_analysis.extracurricular_strengths.map(s => `<li>${s}</li>`).join('')}
                                </ul>
                                ${openAIResponse.strength_analysis.unique_factors.length > 0 ? `
                                <strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã:</strong>
                                <ul style="margin: 5px 0 10px 20px;">
                                    ${openAIResponse.strength_analysis.unique_factors.map(s => `<li>${s}</li>`).join('')}
                                </ul>` : ''}
                                ${openAIResponse.strength_analysis.weaknesses.length > 0 ? `
                                <strong>–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:</strong>
                                <ul style="margin: 5px 0 10px 20px;">
                                    ${openAIResponse.strength_analysis.weaknesses.map(s => `<li>${s}</li>`).join('')}
                                </ul>` : ''}
                            </div>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px;">
                            <h4>üöÄ –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è</h4>
                            <div style="margin-top: 10px;">
                                ${openAIResponse.improvement_recommendations.map(rec => `
                                    <div style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                            <strong>${rec.category}</strong>
                                            <span style="background: ${rec.priority === 'high' ? '#ff4444' : rec.priority === 'medium' ? '#ffaa00' : '#44ff44'}; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; color: white;">
                                                ${rec.priority === 'high' ? '–í—ã—Å–æ–∫–∏–π' : rec.priority === 'medium' ? '–°—Ä–µ–¥–Ω–∏–π' : '–ù–∏–∑–∫–∏–π'}
                                            </span>
                                        </div>
                                        <div style="font-size: 0.9rem; margin-bottom: 5px;">${rec.recommendation}</div>
                                        <div style="font-size: 0.8rem; opacity: 0.8;">‚è±Ô∏è ${rec.timeline}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    ${openAIResponse.alternative_universities.length > 0 ? `
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h3>üéì –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 15px;">
                            ${openAIResponse.alternative_universities.map(uni => `
                                <div style="background: rgba(255,255,255,0.3); padding: 15px; border-radius: 10px;">
                                    <h4>${uni.name}</h4>
                                    <div style="font-size: 0.9rem;">${uni.reason}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>` : ''}
                    ${openAIResponse.comparable_profiles.length > 0 ? `
                    <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <h3>üë• –ü–æ—Ö–æ–∂–∏–µ —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏</h3>
                        <ul style="margin-top: 10px; line-height: 1.8;">
                            ${openAIResponse.comparable_profiles.map(profile => `<li>${profile}</li>`).join('')}
                        </ul>
                    </div>` : ''}
                    ${documentsFeedbackHtml}
                </div>
            `;
        }

        function fallbackCalculation(university, major, data) {
            let score = 0;
            if (data.requirements) {
                if (data.sat > 0 && data.requirements.sat_typical) score += Math.min((data.sat / data.requirements.sat_typical) * 25, 25);
                if (data.ielts > 0 && data.requirements.ielts_typical) score += Math.min((data.ielts / data.requirements.ielts_typical) * 15, 15);
                if (data.toefl > 0 && data.requirements.toefl_typical) score += Math.min((data.toefl / data.requirements.toefl_typical) * 15, 15);
                if (data.ent > 0 && data.requirements.ent_typical) score += Math.min((data.ent / data.requirements.ent_typical) * 10, 10);
                if (data.gpa > 0 && data.requirements.gpa_typical) score += Math.min((data.gpa / data.requirements.gpa_typical) * 15, 15);
            } else {
                if (data.sat > 0) score += (data.sat / 1600) * 25;
                if (data.ielts > 0) score += (data.ielts / 9) * 15;
                if (data.toefl > 0) score += (data.toefl / 120) * 15;
                if (data.ent > 0) score += (data.ent / 140) * 10;
                if (data.gpa > 0) score += (data.gpa / 4) * 15;
            }
            const activitiesCount = Object.values(data.activities).filter(a => a.trim().length > 0).length;
            score += (activitiesCount / 9) * 40;
            const difficultyModifiers = { 'harvard': 0.7, 'mit': 0.7, 'stanford': 0.75, 'oxford': 0.8, 'cambridge': 0.8, 'nazarbayev': 0.85, 'kimep': 0.9 };
            if (difficultyModifiers[university.toLowerCase()]) score *= difficultyModifiers[university.toLowerCase()];
            const resultDiv = document.getElementById('result');
            let resultClass = score >= 70 ? 'result-high' : score >= 40 ? 'result-medium' : 'result-low';
            let resultText = score >= 70 ? 'üéâ –í—ã—Å–æ–∫–∏–µ —à–∞–Ω—Å—ã' : score >= 40 ? '‚ö° –°—Ä–µ–¥–Ω–∏–µ —à–∞–Ω—Å—ã' : 'üìö –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞';
            resultDiv.innerHTML = `
                <div class="result-card ${resultClass}">
                    <h2>${resultText} –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è (${Math.round(score)}%)</h2>
                    <p style="margin: 15px 0;">–¥–ª—è ${university} - ${major}</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin: 20px 0;">
                        <p>‚ö†Ô∏è –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω –ø–æ –±–∞–∑–æ–≤–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É. ${data.requirements ? '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ Supabase.' : '–î–ª—è —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase –∏ API.'}</p>
                        ${data.requirements ? `
                        <h3>üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞:</h3>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li><strong>SAT (—Ç–∏–ø–∏—á–Ω—ã–π):</strong> ${data.requirements.sat_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</li>
                            <li><strong>IELTS (—Ç–∏–ø–∏—á–Ω—ã–π):</strong> ${data.requirements.ielts_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</li>
                            <li><strong>TOEFL (—Ç–∏–ø–∏—á–Ω—ã–π):</strong> ${data.requirements.toefl_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</li>
                            <li><strong>–ï–ù–¢ (—Ç–∏–ø–∏—á–Ω—ã–π):</strong> ${data.requirements.ent_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</li>
                            <li><strong>GPA (—Ç–∏–ø–∏—á–Ω—ã–π):</strong> ${data.requirements.gpa_typical || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</li>
                            <li><strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</strong> ${data.requirements.additional_requirements || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</li>
                        </ul>` : ''}
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin: 20px 0;">
                        <h3>üìã –í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</h3>
                        ${Object.entries(data.activities).filter(([_, v]) => v.trim().length > 0).map(([category, content]) => `
                            <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 8px;">
                                <strong>${getCategoryName(category)}:</strong>
                                <p style="margin-top: 5px; font-size: 0.9rem;">${content}</p>
                            </div>
                        `).join('') || '<p>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã</p>'}
                    </div>
                </div>
            `;
        }

        async function populateDropdowns() {
            try {
                const { data, error } = await supabase.from('university_requirements').select('university, major').order('university, major');
                if (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
                    return;
                }
                const [universities, majors] = [new Set(data.map(item => item.university)), new Set(data.map(item => item.major))];
                ['university', 'major'].forEach(id => {
                    const select = document.getElementById(id);
                    if (select) select.innerHTML = `<option value="">–í—ã–±–µ—Ä–∏—Ç–µ ${id === 'university' ? '—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç' : '—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å'}</option>` + [...(id === 'university' ? universities : majors)].map(v => `<option value="${v}">${v}</option>`).join('');
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤');
            }
        }

        function getCategoryName(category) {
            const names = {
                olympics: 'üèÖ –û–ª–∏–º–ø–∏–∞–¥—ã',
                research: 'üî¨ –ù–∞—É—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã',
                projects: 'üíª IT –ø—Ä–æ–µ–∫—Ç—ã',
                startup: 'üöÄ –°—Ç–∞—Ä—Ç–∞–ø—ã',
                conferences: 'üé§ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏',
                volunteer: '‚ù§Ô∏è –í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ',
                leadership: 'üëë –õ–∏–¥–µ—Ä—Å—Ç–≤–æ',
                arts: 'üé® –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ',
                work_experience: 'üíº –†–∞–±–æ—á–∏–π –æ–ø—ã—Ç –∏ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∏'
            };
            return names[category] || category;
        }

        function addPost() {
            const fields = ['postUniversity', 'postMajor', 'postScores', 'postAdvice'].map(id => document.getElementById(id)?.value);
            if (fields.some(f => !f)) return alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.');
            samplePosts.unshift({ author: "–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", university: fields[0], major: fields[1], date: new Date().toISOString().split('T')[0], scores: fields[2], activities: "", advice: fields[3] });
            loadCommunityPosts();
            fields.forEach((_, i) => document.getElementById(['postUniversity', 'postMajor', 'postScores', 'postAdvice'][i]).value = '');
            document.getElementById('postSop').value = '';
            document.getElementById('postLor').value = '';
            alert('–ü–æ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω!');
        }

        function loadCommunityPosts() {
            document.getElementById('communityPosts').innerHTML = samplePosts.map(post => `
                <div class="community-post">
                    <div class="post-header">
                        <div>
                            <span class="post-author">${post.author}</span>
                            <span class="university-tag">${post.university}</span>
                            <span class="university-tag" style="background: #4caf50;">${post.major}</span>
                        </div>
                        <div class="post-date">${new Date(post.date).toLocaleDateString('ru-RU')}</div>
                    </div>
                    <div style="margin: 10px 0;">
                        <strong>üìä –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏:</strong> ${post.scores}
                        ${post.activities ? `<br><strong>üèÜ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</strong> ${post.activities}` : ''}
                    </div>
                    <div style="background: #f0f4ff; padding: 15px; border-radius: 10px; margin-top: 15px;">
                        <strong>üí° –°–æ–≤–µ—Ç:</strong> ${post.advice}
                    </div>
                </div>
            `).join('');
        }

        function loadProfileData() {
            const userData = JSON.parse(localStorage.getItem('userData')) || {};
            const fieldMappings = {
                userName: 'full_name',
                userEmail: 'email',
                family_income: 'family_income',
                gpa: 'gpa',
                sat: 'sat',
                ielts: 'ielts',
                toefl: 'toefl',
                ent: 'ent',
                olympics: 'olympics',
                research: 'research',
                projects: 'projects',
                startup: 'startup',
                conferences: 'conferences',
                volunteer: 'volunteer',
                leadership: 'leadership',
                arts: 'arts',
                work_experience: 'work_experience',
                sopTextArea: 'sopText',
                lorTextArea: 'lorText'
            };

            Object.entries(fieldMappings).forEach(([fieldId, dataKey]) => {
                const element = document.getElementById(fieldId);
                if (element) element.value = userData[dataKey] || '';
            });
        }
        
    </script>
</body>
</html>